# SPDX-License-Identifier: GPL-2.0
%YAML 1.2
---
$id: http://devicetree.org/schemas/pci/snps,pcie.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: Synopsys DesignWare PCIe interface

maintainers:
  - Jingoo Han <jingoohan1@gmail.com>
  - Gustavo Pimentel <gustavo.pimentel@synopsys.com>

description: |
  Synopsys DesignWare PCIe host controller

anyOf:
  - {}
  - items:
      contains:
        enum:
          - snps,dw-pcie
          - snps,dw-pcie-ep

properties:
  compatible:
    description: |
      The compatible can be either:
      - snps,dw-pcie       # for RC mode
      - snps,dw-pcie-ep    # For EP mode
      or some other value, when there's a host-specific driver

  reg:
    description: |
      Contains DBI and the configuration address space for all
      Designware versions.
      For Designware core version >= 4.80, should also contain the
      ATU address space.
    minItems: 2
    maxItems: 4

  reset-gpio:
    description: GPIO pin number for the PERST# signal
    maxItems: 1

  clocks:
    minItems: 2
    maxItems: 8

  clock-names:
    items:
      contains:
        enum: [ pcie, pcie_bus ]
    minItems: 2
    maxItems: 8

  "snps,enable-cdm-check":
    $ref: /schemas/types.yaml#definitions/flag
    description: |
      This is a boolean property and if present enables
      automatic checking of CDM (Configuration Dependent Module) registers
      for data corruption. CDM registers include standard PCIe configuration
      space registers, Port Logic registers, DMA and iATU (internal Address
      Translation Unit) registers.

  # The following are optional properties for RC mode

  num-viewport:
    description: |
      number of view ports configured in hardware. If a platform
      does not specify it, the driver assumes 2.
    deprecated: true

  # The following are mandatory properties for EP Mode

  num-ib-windows:
    description: number of inbound address translation windows
    maxItems: 1
    deprecated: true

  num-ob-windows:
    description: number of outbound address translation windows
    maxItems: 1
    deprecated: true

  # The following are optional properties for EP mode

  max-functions:
    description: maximum number of functions that can be configured

required:
  - reg
  - reg-names

allOf:
  - if:
      properties:
        compatible:
          contains:
            const: snps,dw-pcie
    then:
      allOf:
        - $ref: /schemas/pci/pci-bus.yaml#
  - if:
      properties:
        compatible:
          contains:
            const: snps,dw-pcie-ep
    then:
      required:
        - compatible

additionalProperties: false

examples:
  - |
    pcie: pcie@dfc00000 {
      compatible = "snps,dw-pcie";
      reg = <0xdfc00000 0x0001000>, /* IP registers */
            <0xd0000000 0x0002000>; /* Configuration space */
      reg-names = "dbi", "config";
      #address-cells = <3>;
      #size-cells = <2>;
      device_type = "pci";
      ranges = <0x81000000 0 0x00000000 0xde000000 0 0x00010000>,
               <0x82000000 0 0xd0400000 0xd0400000 0 0x0d000000>;
      interrupts = <25>, <24>;
      #interrupt-cells = <1>;
      num-lanes = <1>;
    };
    pcie_ep: pcie_ep@dfd00000 {
      compatible = "snps,dw-pcie-ep";
      reg = <0xdfc00000 0x0001000>, /* IP registers 1 */
            <0xdfc01000 0x0001000>, /* IP registers 2 */
            <0xd0000000 0x2000000>; /* Configuration space */
      reg-names = "dbi", "dbi2", "addr_space";
      num-ib-windows = <6>;
      num-ob-windows = <2>;
      num-lanes = <1>;
    };
